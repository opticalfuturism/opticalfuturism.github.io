<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optical Art Generator V2 - Optical Futurism</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const Download = ({ size }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            </svg>
        );

        function OpticalArtGeneratorV2() {
            const canvasRef = useRef(null);
            const [circles, setCircles] = useState(190);
            const [spacing, setSpacing] = useState(25);
            const [lineWidth, setLineWidth] = useState(0.70);
            const [resolution, setResolution] = useState(3240);
            const [colors, setColors] = useState(['#6B21A8', '#FACC15', '#22C55E', '#3B82F6']);
            const [colorWidths, setColorWidths] = useState([0.70, 0.70, 0.70, 0.70]);
            const [selectedColorIndex, setSelectedColorIndex] = useState(0);
            const [widthModulations, setWidthModulations] = useState([]);
            const [isDrawing, setIsDrawing] = useState(false);
            const [centerDistortion, setCenterDistortion] = useState(0);
            const [edgeDistortion, setEdgeDistortion] = useState(0);
            
            const [shapes, setShapes] = useState({
                circles: true,
                horizontalLines: false,
                verticalLines: false,
                diagonalLines: false,
                triangles: false,
                squares: false
            });

            const width = resolution;
            const height = resolution;

            const draw = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = colors[0];
                ctx.fillRect(0, 0, width, height);

                const centerX = width / 2;
                const centerY = height / 2;

                for (let i = 0; i < circles; i++) {
                    const baseRadius = (i + 1) * spacing;
                    const colorIndex = i % colors.length;
                    ctx.strokeStyle = colors[colorIndex];
                    
                    let baseWidth = spacing * colorWidths[colorIndex];
                    
                    widthModulations.forEach(mod => {
                        const radiusDiff = Math.abs(baseRadius - mod.radius);
                        if (radiusDiff < mod.falloff) {
                            const influence = 1 - (radiusDiff / mod.falloff);
                            baseWidth *= (1 + mod.multiplier * influence);
                        }
                    });

                    if (shapes.circles) {
                        ctx.beginPath();
                        const segments = 360;
                        for (let angle = 0; angle <= segments; angle++) {
                            const theta = (angle / segments) * Math.PI * 2;
                            const radius = baseRadius;
                            
                            const x = centerX + Math.cos(theta) * radius;
                            const y = centerY + Math.sin(theta) * radius;
                            
                            const maxRadius = Math.min(width, height) / 2;
                            const distanceFromCenter = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                            const normalizedDistance = Math.min(distanceFromCenter / maxRadius, 1);
                            
                            let widthMultiplier = 1;
                            const centerInfluence = 1 - normalizedDistance;
                            widthMultiplier += (centerDistortion / 100) * centerInfluence;
                            const edgeInfluence = normalizedDistance;
                            widthMultiplier += (edgeDistortion / 100) * edgeInfluence;
                            
                            ctx.lineWidth = Math.max(0.1, baseWidth * widthMultiplier);

                            if (angle === 0) {
                                ctx.moveTo(x, y);
                            } else {
                                ctx.lineTo(x, y);
                            }
                        }
                        ctx.closePath();
                        ctx.stroke();
                    }

                    if (shapes.horizontalLines) {
                        const y = centerY - baseRadius;
                        const y2 = centerY + baseRadius;
                        
                        ctx.lineWidth = baseWidth;
                        ctx.beginPath();
                        ctx.moveTo(0, y);
                        ctx.lineTo(width, y);
                        ctx.stroke();
                        
                        if (y !== y2) {
                            ctx.beginPath();
                            ctx.moveTo(0, y2);
                            ctx.lineTo(width, y2);
                            ctx.stroke();
                        }
                    }

                    if (shapes.verticalLines) {
                        const x = centerX - baseRadius;
                        const x2 = centerX + baseRadius;
                        
                        ctx.lineWidth = baseWidth;
                        ctx.beginPath();
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, height);
                        ctx.stroke();
                        
                        if (x !== x2) {
                            ctx.beginPath();
                            ctx.moveTo(x2, 0);
                            ctx.lineTo(x2, height);
                            ctx.stroke();
                        }
                    }

                    if (shapes.diagonalLines) {
                        ctx.lineWidth = baseWidth;
                        
                        ctx.beginPath();
                        ctx.moveTo(centerX - baseRadius, centerY);
                        ctx.lineTo(centerX, centerY - baseRadius);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY + baseRadius);
                        ctx.lineTo(centerX + baseRadius, centerY);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(centerX + baseRadius, centerY);
                        ctx.lineTo(centerX, centerY - baseRadius);
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY + baseRadius);
                        ctx.lineTo(centerX - baseRadius, centerY);
                        ctx.stroke();
                    }

                    if (shapes.squares) {
                        const size = baseRadius * 2;
                        ctx.lineWidth = baseWidth;
                        ctx.beginPath();
                        ctx.rect(centerX - baseRadius, centerY - baseRadius, size, size);
                        ctx.stroke();
                    }

                    if (shapes.triangles) {
                        const triHeight = baseRadius * Math.sqrt(3);
                        ctx.lineWidth = baseWidth;
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY - (triHeight * 2/3));
                        ctx.lineTo(centerX - baseRadius, centerY + (triHeight * 1/3));
                        ctx.lineTo(centerX + baseRadius, centerY + (triHeight * 1/3));
                        ctx.closePath();
                        ctx.stroke();
                    }
                }
            };

            useEffect(() => {
                draw();
            }, [circles, spacing, colors, colorWidths, resolution, widthModulations, centerDistortion, edgeDistortion, shapes]);

            const handleCanvasMouseDown = (e) => {
                setIsDrawing(true);
                handleCanvasMouseMove(e);
            };

            const handleCanvasMouseMove = (e) => {
                if (!isDrawing) return;

                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const scaleX = width / rect.width;
                const scaleY = height / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;

                const centerX = width / 2;
                const centerY = height / 2;
                const distanceFromCenter = Math.sqrt((x - centerX) ** 2 + (y - centerY) ** 2);
                
                setWidthModulations(prev => {
                    const existing = prev.find(w => Math.abs(w.radius - distanceFromCenter) < 100);
                    
                    if (existing) {
                        return prev.map(w => 
                            w === existing 
                                ? { ...w, radius: distanceFromCenter }
                                : w
                        );
                    }
                    
                    return [...prev, { radius: distanceFromCenter, multiplier: 1, falloff: 100 }];
                });
            };

            const handleCanvasMouseUp = () => {
                setIsDrawing(false);
            };

            const exportPNG = () => {
                const canvas = canvasRef.current;
                
                try {
                    canvas.toBlob((blob) => {
                        if (blob) {
                            const url = URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.download = `optical-art-v2-${Date.now()}.png`;
                            link.href = url;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            setTimeout(() => URL.revokeObjectURL(url), 100);
                        }
                    }, 'image/png', 1.0);
                } catch (error) {
                    console.error('Export failed:', error);
                    alert('Export failed. Try reducing the resolution.');
                }
            };

            const clearWidthMods = () => {
                setWidthModulations([]);
            };

            const resetAll = () => {
                setCircles(190);
                setSpacing(25);
                setLineWidth(0.70);
                setResolution(3240);
                setColors(['#6B21A8', '#FACC15', '#22C55E', '#3B82F6']);
                setColorWidths([0.70, 0.70, 0.70, 0.70]);
                setWidthModulations([]);
                setCenterDistortion(0);
                setEdgeDistortion(0);
                setShapes({
                    circles: true,
                    horizontalLines: false,
                    verticalLines: false,
                    diagonalLines: false,
                    triangles: false,
                    squares: false
                });
            };

            const addColor = () => {
                const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                setColors([...colors, randomColor]);
            };

            return React.createElement('div', { className: "w-full min-h-screen bg-gray-900 text-white p-4" },
                React.createElement('div', { className: "max-w-6xl mx-auto" },
                    React.createElement('h1', { className: "text-3xl font-bold mb-6 text-center" }, 'Optical Art Generator V2'),
                    React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-6" },
                        React.createElement('div', { className: "lg:col-span-2" },
                            React.createElement('div', { className: "bg-gray-800 p-4 rounded-lg" },
                                React.createElement('canvas', {
                                    ref: canvasRef,
                                    width: width,
                                    height: height,
                                    className: "w-full border-2 border-gray-700 rounded cursor-pointer",
                                    onMouseDown: handleCanvasMouseDown,
                                    onMouseMove: handleCanvasMouseMove,
                                    onMouseUp: handleCanvasMouseUp,
                                    onMouseLeave: handleCanvasMouseUp
                                }),
                                React.createElement('div', { className: "text-sm text-gray-400 mt-2" },
                                    React.createElement('span', null, 'Click to add line width modulation points')
                                )
                            )
                        ),
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', { className: "bg-gray-800 p-4 rounded-lg space-y-3" },
                                React.createElement('h3', { className: "font-semibold mb-2" }, 'Export'),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-sm text-gray-400" }, `Resolution: ${resolution}x${resolution}`),
                                    React.createElement('select', {
                                        value: resolution,
                                        onChange: (e) => setResolution(Number(e.target.value)),
                                        className: "w-full bg-gray-700 text-white px-3 py-2 rounded mt-1"
                                    },
                                        React.createElement('option', { value: 1080 }, '1080x1080 (Instagram)'),
                                        React.createElement('option', { value: 2160 }, '2160x2160 (2K)'),
                                        React.createElement('option', { value: 3240 }, '3240x3240 (3K)'),
                                        React.createElement('option', { value: 4320 }, '4320x4320 (4K)')
                                    )
                                ),
                                React.createElement('button', {
                                    onClick: exportPNG,
                                    className: "w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded flex items-center justify-center gap-2"
                                },
                                    React.createElement(Download, { size: 18 }),
                                    'Export PNG'
                                )
                            ),
                            React.createElement('div', { className: "bg-gray-800 p-4 rounded-lg space-y-3" },
                                React.createElement('h3', { className: "font-semibold mb-2" }, 'Shape Options'),
                                React.createElement('div', { className: "space-y-2" },
                                    ['circles', 'squares', 'triangles', 'horizontalLines', 'verticalLines', 'diagonalLines'].map(shape => {
                                        const labels = {
                                            circles: 'Circles',
                                            squares: 'Squares',
                                            triangles: 'Triangles',
                                            horizontalLines: 'Horizontal Lines',
                                            verticalLines: 'Vertical Lines',
                                            diagonalLines: 'Diagonal Lines'
                                        };
                                        return React.createElement('label', { 
                                            key: shape,
                                            className: "flex items-center gap-2 cursor-pointer hover:bg-gray-700 p-2 rounded" 
                                        },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: shapes[shape],
                                                onChange: (e) => setShapes({...shapes, [shape]: e.target.checked}),
                                                className: "w-4 h-4 cursor-pointer"
                                            }),
                                            React.createElement('span', { className: "text-sm" }, labels[shape])
                                        );
                                    })
                                )
                            ),
                            React.createElement('div', { className: "bg-gray-800 p-4 rounded-lg space-y-3" },
                                React.createElement('h3', { className: "font-semibold mb-2" }, 'Pattern Settings'),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-sm text-gray-400" }, `Number of Layers: ${circles}`),
                                    React.createElement('input', {
                                        type: "range",
                                        min: "10",
                                        max: "500",
                                        value: circles,
                                        onChange: (e) => setCircles(Number(e.target.value)),
                                        className: "w-full"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-sm text-gray-400" }, `Spacing: ${spacing}`),
                                    React.createElement('input', {
                                        type: "range",
                                        min: "1",
                                        max: "30",
                                        step: "0.5",
                                        value: spacing,
                                        onChange: (e) => setSpacing(Number(e.target.value)),
                                        className: "w-full"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-sm text-gray-400" }, `Line Width: ${lineWidth.toFixed(2)}`),
                                    React.createElement('input', {
                                        type: "range",
                                        min: "0.1",
                                        max: "2",
                                        step: "0.05",
                                        value: lineWidth,
                                        onChange: (e) => {
                                            const newWidth = Number(e.target.value);
                                            setLineWidth(newWidth);
                                            setColorWidths(colors.map(() => newWidth));
                                        },
                                        className: "w-full"
                                    }),
                                    React.createElement('p', { className: "text-xs text-gray-500 mt-1" }, 'Adjusts all colors at once')
                                )
                            ),
                            React.createElement('div', { className: "bg-gray-800 p-4 rounded-lg space-y-3" },
                                React.createElement('h3', { className: "font-semibold mb-2" }, 'Radial Line Width'),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-sm text-gray-400" }, `Center → Out: ${centerDistortion}`),
                                    React.createElement('input', {
                                        type: "range",
                                        min: "-200",
                                        max: "200",
                                        value: centerDistortion,
                                        onChange: (e) => setCenterDistortion(Number(e.target.value)),
                                        className: "w-full"
                                    }),
                                    React.createElement('p', { className: "text-xs text-gray-500 mt-1" }, 'Adjusts line width from center outward')
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "text-sm text-gray-400" }, `Edge → In: ${edgeDistortion}`),
                                    React.createElement('input', {
                                        type: "range",
                                        min: "-200",
                                        max: "200",
                                        value: edgeDistortion,
                                        onChange: (e) => setEdgeDistortion(Number(e.target.value)),
                                        className: "w-full"
                                    }),
                                    React.createElement('p', { className: "text-xs text-gray-500 mt-1" }, 'Adjusts line width from edge inward')
                                ),
                                React.createElement('button', {
                                    onClick: () => {
                                        setCenterDistortion(0);
                                        setEdgeDistortion(0);
                                    },
                                    className: "w-full bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-sm"
                                }, 'Reset Radial Width')
                            ),
                            React.createElement('div', { className: "bg-gray-800 p-4 rounded-lg space-y-3" },
                                React.createElement('h3', { className: "font-semibold mb-2" }, 'Colors'),
                                React.createElement('div', { className: "flex flex-wrap gap-2 mb-3" },
                                    colors.map((color, i) =>
                                        React.createElement('div', { key: i, className: "relative" },
                                            React.createElement('button', {
                                                onClick: () => setSelectedColorIndex(i),
                                                className: `w-12 h-12 rounded cursor-pointer transition-all ${
                                                    selectedColorIndex === i ? 'ring-4 ring-white scale-110' : 'ring-2 ring-gray-600'
                                                }`,
                                                style: { backgroundColor: color }
                                            }),
                                            selectedColorIndex === i && React.createElement('div', { 
                                                className: "absolute -top-1 -right-1 w-4 h-4 bg-white rounded-full flex items-center justify-center text-xs text-black" 
                                            }, '✓')
                                        )
                                    )
                                ),
                                selectedColorIndex !== null && React.createElement('div', { className: "bg-gray-700 p-3 rounded" },
                                    React.createElement('div', { className: "flex items-center justify-between mb-2" },
                                        React.createElement('span', { className: "text-sm font-medium" }, `Color ${selectedColorIndex + 1}`),
                                        colors.length > 2 && React.createElement('button', {
                                            onClick: () => {
                                                setColors(colors.filter((_, idx) => idx !== selectedColorIndex));
                                                setColorWidths(colorWidths.filter((_, idx) => idx !== selectedColorIndex));
                                                setSelectedColorIndex(Math.max(0, selectedColorIndex - 1));
                                            },
                                            className: "text-red-400 hover:text-red-300 text-sm px-2 py-1 bg-red-900/30 rounded"
                                        }, 'Delete')
                                    ),
                                    React.createElement('div', { className: "mb-3" },
                                        React.createElement('label', { className: "text-xs text-gray-400 mb-1 block" }, 'Color'),
                                        React.createElement('input', {
                                            type: "color",
                                            value: colors[selectedColorIndex],
                                            onChange: (e) => {
                                                const newColors = [...colors];
                                                newColors[selectedColorIndex] = e.target.value;
                                                setColors(newColors);
                                            },
                                            className: "w-full h-10 rounded cursor-pointer"
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: "text-xs text-gray-400" }, `Line Width: ${(colorWidths[selectedColorIndex] || 0.70).toFixed(2)}`),
                                        React.createElement('input', {
                                            type: "range",
                                            min: "0.1",
                                            max: "10",
                                            step: "0.1",
                                            value: colorWidths[selectedColorIndex] || 0.70,
                                            onChange: (e) => {
                                                const newWidths = [...colorWidths];
                                                newWidths[selectedColorIndex] = Number(e.target.value);
                                                setColorWidths(newWidths);
                                            },
                                            className: "w-full"
                                        })
                                    )
                                ),
                                React.createElement('button', {
                                    onClick: () => {
                                        addColor();
                                        setColorWidths([...colorWidths, 0.70]);
                                        setSelectedColorIndex(colors.length);
                                    },
                                    className: "w-full bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded text-sm"
                                }, '+ Add Color')
                            ),
                            React.createElement('div', { className: "bg-gray-800 p-4 rounded-lg space-y-3" },
                                React.createElement('h3', { className: "font-semibold mb-2" }, 'Effects'),
                                React.createElement('div', { className: "space-y-2" },
                                    React.createElement('div', { className: "flex items-center justify-between text-sm" },
                                        React.createElement('span', { className: "text-gray-400" }, `Width Mods: ${widthModulations.length}`),
                                        React.createElement('button', {
                                            onClick: clearWidthMods,
                                            className: "bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded text-xs"
                                        }, 'Clear')
                                    )
                                ),
                                React.createElement('button', {
                                    onClick: resetAll,
                                    className: "w-full bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded"
                                }, 'Reset Everything')
                            )
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(OpticalArtGeneratorV2));
    </script>
</body>
</html>
